<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FNLB - Bot Management Platform</title>
  <style>
    /* keep your full dashboard CSS here (same as before) */
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="logo-section">
      <button class="menu-btn">
        <svg class="icon-lg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="4" x2="20" y1="6" y2="6"/>
          <line x1="4" x2="20" y1="12" y2="12"/>
          <line x1="4" x2="20" y1="18" y2="18"/>
        </svg>
      </button>
      <div class="logo">
        <div class="logo-icon">FN</div>
        <span class="logo-text">LB</span>
      </div>
    </div>
  </header>

  <div class="main-container">
    <!-- Sidebar -->
    <div class="sidebar">
      <button class="nav-button active" onclick="showView('public')">Public Bots</button>
      <button class="nav-button" onclick="showView('my-bots')">My Bots</button>
      <button class="nav-button" onclick="showView('account')">My Account</button>
    </div>

    <!-- Content -->
    <div class="content">
      <div class="content-inner">
        <!-- Public Bots -->
        <div id="public-view">
          <div class="page-header">
            <h1>Public Bots</h1>
            <p>Discover and use community bots</p>
          </div>
          <!-- (cards unchanged) -->
        </div>

        <!-- My Bots -->
        <div id="my-bots-view" class="hidden">
          <div class="header-with-actions">
            <div>
              <h1>My Bots</h1>
              <p>Manage your personal bots</p>
            </div>
            <div class="actions">
              <button class="btn btn-success" onclick="startAllBots()">Start All</button>
              <button class="btn btn-danger" onclick="stopAllBots()">Stop All</button>
            </div>
          </div>

          <!-- Category Input -->
          <div style="margin-bottom: 1rem;">
            <label for="categoryInput">Category ID:</label>
            <input id="categoryInput" placeholder="Enter category ID" style="padding:0.5rem; border-radius:0.375rem; border:none; width:100%; max-width:300px;" />
          </div>

          <h2 class="section-title">Trading</h2>
          <div class="grid">
            <div class="card" id="trading-bot-1" onclick="toggleBotControls('trading-bot-1')">
              <div class="card-header">
                <div class="icon-container">
                  <svg class="icon-lg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 8V4H8"/>
                    <rect width="16" height="12" x="4" y="8" rx="2"/>
                  </svg>
                </div>
                <div class="bot-info">
                  <h3>Trading Bot Alpha</h3>
                  <div class="status">
                    <span class="status-dot stopped" id="status-dot-trading-bot-1"></span>
                    <span id="status-text-trading-bot-1">Stopped</span>
                  </div>
                </div>
              </div>
              <p class="card-description">Automated trading bot for cryptocurrency markets</p>
              <div class="bot-controls" id="controls-trading-bot-1">
                <button class="btn btn-success btn-sm" id="start-btn-trading-bot-1" onclick="toggleBot('trading-bot-1',event)">Start</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Account (unchanged) -->
        <div id="account-view" class="hidden">
          <!-- account cards here -->
        </div>
      </div>
    </div>
  </div>

  <script>
    // View switching
    function showView(viewName) {
      document.querySelectorAll('[id$="-view"]').forEach(v => v.classList.add('hidden'));
      document.getElementById(viewName + '-view').classList.remove('hidden');
      document.querySelectorAll('.nav-button').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
    }

    // Backend integration
    async function startBot(category) {
      if (!category) {
        alert("Please enter a category ID first.");
        return;
      }
      const res = await fetch("/start", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ category })
      });
      await res.json();
      updateAllStatuses();
    }

    async function stopBot() {
      await fetch("/stop", { method: "POST" });
      updateAllStatuses();
    }

    async function getStatus() {
      const res = await fetch("/status");
      return await res.json();
    }

    // My Bots controls
    function toggleBotControls(botId) {
      document.getElementById('controls-' + botId).classList.toggle('show');
    }

    async function toggleBot(botId, event) {
      event.stopPropagation();
      const category = document.getElementById("categoryInput").value;
      const current = await getStatus();
      if (current.running) {
        await stopBot();
      } else {
        await startBot(category);
      }
    }

    async function startAllBots() {
      const category = document.getElementById("categoryInput").value;
      await startBot(category);
    }

    async function stopAllBots() {
      await stopBot();
    }

    // Update UI from backend status
    async function updateAllStatuses() {
      const status = await getStatus();
      const isRunning = status.running;
      const dot = document.getElementById("status-dot-trading-bot-1");
      const text = document.getElementById("status-text-trading-bot-1");
      const btn = document.getElementById("start-btn-trading-bot-1");

      dot.className = "status-dot " + (isRunning ? "running" : "stopped");
      text.textContent = isRunning ? "Running" : "Stopped";
      btn.className = "btn " + (isRunning ? "btn-danger btn-sm" : "btn-success btn-sm");
      btn.textContent = isRunning ? "Stop" : "Start";
    }

    // Auto-refresh
    setInterval(updateAllStatuses, 5000);
    updateAllStatuses();

    // Init view
    showView('public');
  </script>
</body>
</html>
