<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>OGbots</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* ... keep all your CSS the same ... */
  </style>
</head>
<body>
  <header class="header">
    <div class="logo">
      <i class="fas fa-robot"></i>
      <span>OGbots</span>
    </div>
  </header>

  <div class="main-container">
    <nav class="sidebar">
      <div class="nav-item active" onclick="showView('dashboard')"><i class="fas fa-home"></i><span>Dashboard</span></div>
      <div class="nav-item" onclick="showView('mybots')"><i class="fas fa-server"></i><span>My Bots</span></div>
      <div class="nav-item" onclick="showView('public')"><i class="fas fa-globe"></i><span>Public Bots</span></div>
    </nav>

    <main class="content">
      <section id="dashboard-view">
        <h1 class="section-title"><i class="fas fa-tachometer-alt"></i> Dashboard</h1>
        <div class="card">
          <h2 class="card-title">Bot Control</h2>
          <div class="input-group">
            <label for="botId">Category ID</label>
            <input type="text" id="botId" placeholder="Enter category ID">
          </div>
          <div class="status-indicator">
            <div class="status-dot" id="statusDot"></div>
            <span id="statusDisplay">Status: Unknown</span>
          </div>
          <div class="btn-group">
            <button class="btn btn-primary" onclick="startBot()"><i class="fas fa-play"></i> Start</button>
            <button class="btn btn-danger" onclick="stopBot()"><i class="fas fa-stop"></i> Stop</button>
            <button class="btn btn-info" onclick="fetchStatus()"><i class="fas fa-sync"></i> Refresh</button>
          </div>
        </div>
        <div class="log-container">
          <div class="log-header">Live Logs</div>
          <div class="log-content" id="output"></div>
        </div>
      </section>

      <section id="mybots-view" class="hidden">
        <h1 class="section-title"><i class="fas fa-server"></i> My Bots <span id="myBotsCount"></span></h1>
        <div class="bot-grid" id="myBotsList"></div>
      </section>

      <section id="public-view" class="hidden">
        <h1 class="section-title"><i class="fas fa-globe"></i> Public Bots</h1>
        <div class="bot-grid" id="publicBotsList"></div>
      </section>
    </main>
  </div>

  <script>
    function showView(view) {
      document.querySelectorAll("main section").forEach(s => s.classList.add("hidden"));
      document.getElementById(view+"-view").classList.remove("hidden");
      document.querySelectorAll(".nav-item").forEach(i=>i.classList.remove("active"));
      document.querySelector(`.nav-item[onclick="showView('${view}')"]`).classList.add("active");

      if(view === "mybots") fetchStatus();
      if(view === "public") buildPublicBots();
    }

    function appendLog(data) {
      const output = document.getElementById("output");
      output.textContent += data + "\n";
      output.scrollTop = output.scrollHeight;
    }

    async function startBot() {
      const botId=document.getElementById("botId").value;
      if(!botId){alert("Enter a category ID");return;}
      const res=await fetch("/start",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({category:botId})});
      const data=await res.json();
      appendLog(JSON.stringify(data));
      fetchStatus();
    }

    async function stopBot() {
      const res=await fetch("/stop",{method:"POST"});
      const data=await res.json();
      appendLog(JSON.stringify(data));
      fetchStatus();
    }

    async function fetchStatus() {
      const res=await fetch("/status");
      const data=await res.json();
      appendLog(JSON.stringify(data));

      const display=document.getElementById("statusDisplay");
      const dot=document.getElementById("statusDot");
      display.textContent=data.running?`Running: ${data.slotsUsed}/${data.slotsMax}`:"Status: Stopped";
      if(data.running){dot.classList.add("running");} else {dot.classList.remove("running");}
      renderMyBots(data.categories);
    }

    function renderMyBots(categories){
      const container=document.getElementById("myBotsList");
      container.innerHTML="";
      categories.forEach(cat=>{
        const div=document.createElement("div");
        div.className="bot-card";
        div.innerHTML=`<div class="bot-header"><div class="bot-name">${cat}</div><div class="bot-status">Running</div></div>`;
        container.appendChild(div);
      });
      document.getElementById("myBotsCount").textContent=`Running: ${categories.length}/10`;
    }

    function buildPublicBots(){
      const container=document.getElementById("publicBotsList");
      container.innerHTML="";
      for(let i=1;i<=75;i++){
        const div=document.createElement("div");
        div.className="bot-card";
        div.innerHTML=`<div class="bot-header"><div class="bot-name">OGsbot${i}</div><div class="bot-status">Running</div></div>`;
        container.appendChild(div);
      }
    }

    function initLogStream(){
      const ws = new WebSocket(`ws://${location.host}/logs`);
      ws.onmessage = (event)=>appendLog(event.data);
    }

    // Init
    fetchStatus();
    setInterval(fetchStatus,5000);
    initLogStream();
  </script>
</body>
</html>
